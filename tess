local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local Player = game:GetService("Players").LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- // 1. INITIALIZE WINDOW // --
local Window = WindUI:CreateWindow({
    Title = "Vanished Hub",
    PublicTitle = "v1.0",
    Icon = "lucide:skull",
    Theme = "Dark",
    Size = UDim2.fromOffset(580, 460),
    Transparent = true,
})

MinimizeKey = Window:SetToggleKey(Enum.KeyCode.RightControl)
Window:DisableTopbarButtons({})

-- // 2. DAFTARKAN TAB // --
local MainTab = Window:Tab({ Title = "Main", Icon = "lucide:house" })
local AboutTab = Window:Tab({ Title = "About", Icon = "info" })

-- // 3. DATABASE & VARIABLES // --
local Dictionary, UsedWords, Blacklist = {}, {}, {}
local KamusReady, MyTurnActive, IsMatchActive = false, false, false -- Tambah IsMatchActive
local PriorityLetter, CurrentPrefix = "", ""

local VirtualInputManager = game:GetService("VirtualInputManager")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local MatchUIEvent = ReplicatedStorage.Remotes:WaitForChild("MatchUI")
local BillboardEnd = ReplicatedStorage.Remotes:WaitForChild("BillboardEnd")
local ResultUIEvent = ReplicatedStorage.Remotes:WaitForChild("ResultUI")

-- // 4. AUTO EQUIP AURA (PETALS) // --
task.spawn(function()
    local AuraRemote = ReplicatedStorage:FindFirstChild("Aura_RF", true)
    if AuraRemote then
        AuraRemote:InvokeServer("EquipAura", "Petals")
        WindUI:Notify({ Title = "Aura Active", Content = "Petals Aura equipped!", Duration = 5 })
    end
end)

-- // 5. LOAD KAMUS // --
local function loadKamus()
    local BlacklistURL = "https://raw.githubusercontent.com/hasanainmakhluf/last-letter/refs/heads/main/blacklist.txt"
    local KamusURLs = {
        "https://raw.githubusercontent.com/hasanainmakhluf/last-letter/refs/heads/main/KBBI1.txt",
        "https://raw.githubusercontent.com/hasanainmakhluf/last-letter/refs/heads/main/KBBI2.txt",
        "https://raw.githubusercontent.com/hasanainmakhluf/last-letter/refs/heads/main/KBBI3.txt",
        "https://raw.githubusercontent.com/hasanainmakhluf/last-letter/refs/heads/main/KBBI4.txt",
        "https://raw.githubusercontent.com/hasanainmakhluf/last-letter/refs/heads/main/KBBIv4.txt",
        "https://raw.githubusercontent.com/geovedi/indonesian-wordlist/master/01-kbbi3-2001-sort-alpha.lst",
        "https://raw.githubusercontent.com/hasanainmakhluf/last-letter/refs/heads/main/KBBI5"
    }
    pcall(function()
        local bRes = game:HttpGet(BlacklistURL)
        for line in bRes:gmatch("[^\r\n]+") do Blacklist[line:lower():gsub("%s+", "")] = true end
    end)
    for _, url in ipairs(KamusURLs) do
        pcall(function()
            local res = game:HttpGet(url)
            for line in res:gmatch("[^\r\n]+") do
                local word = line:match("^%s*([%a%-]+)")
                if word then
                    local clean = word:lower():gsub("[^%a]", "")
                    if #clean >= 2 and not Blacklist[clean] then Dictionary[clean] = true end
                end
            end
        end)
    end
    KamusReady = true
end
task.spawn(loadKamus)

-- // 6. LOGIKA AUTO-INPUT // --
local function cariKataBaru(prefix)
    local matches, priorityMatches = {}, {}
    for w in pairs(Dictionary) do
        if w:sub(1, #prefix) == prefix and not UsedWords[w] and #w > #prefix then
            if _G.PriorityActive and PriorityLetter ~= "" and w:sub(-#PriorityLetter) == PriorityLetter then
                table.insert(priorityMatches, w)
            end
            table.insert(matches, w)
        end
    end
    if #priorityMatches > 0 then return priorityMatches[math.random(1, #priorityMatches)] end
    return #matches > 0 and matches[math.random(1, #matches)] or nil
end

local function executeAutoInput()
    local retry = 0
    while MyTurnActive and retry < 5 do
        local chosen = cariKataBaru(CurrentPrefix)
        if not chosen then break end
        task.wait(2)
        local suffix = chosen:sub(#CurrentPrefix + 1)
        for i = 1, #suffix do
            if not MyTurnActive then break end
            local key = suffix:sub(i,i):upper()
            local success, keyCode = pcall(function() return Enum.KeyCode[key] end)
            if success and keyCode then
                VirtualInputManager:SendKeyEvent(true, keyCode, false, game)
                task.wait(0.01)
                VirtualInputManager:SendKeyEvent(false, keyCode, false, game)
                pcall(function() ReplicatedStorage.Remotes.TypeSound:FireServer() end)
            end
            task.wait(math.random(10, 50) / 100)
        end
        if MyTurnActive then
            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
            task.wait(0.01) VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
            UsedWords[chosen] = true
            task.wait(1)
            retry = retry + 1
        end
    end
end

-- // 7. ISI MENU // --
local AutoAns = MainTab:Toggle({
    Title = "Auto Answer",
    Description = "Menjawab otomatis saat giliranmu",
    Value = false,
    Callback = function() end
})

MainTab:Input({
    Title = "Priority Last Letter",
    Placeholder = "Contoh: k",
    Callback = function(v) PriorityLetter = v:lower():gsub("%s+", "") end
})

MainTab:Toggle({
    Title = "Enable Priority Letter",
    Value = false,
    Callback = function(v) _G.PriorityActive = v end
})

MainTab:Toggle({
    Title = "Auto Join Table 8",
    Value = false,
    Callback = function(v)
        _G.AutoJoin = v
        task.spawn(function()
            while _G.AutoJoin do
                if not Player:GetAttribute("CurrentTable") then ReplicatedStorage.Remotes.JoinTable:FireServer("Table_8P") end
                task.wait(2)
            end
        end)
    end
})

MainTab:Toggle({
    Title = "Unblock Jump & Speed",
    Value = false,
    Callback = function(v)
        _G.UnblockActive = v
        local CAS = game:GetService("ContextActionService")
        local hum = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")

        if not v then
            -- // JIKA DI-OFF-KAN // --
            -- Paksa Bind kembali aksi blokir agar Spasi tidak berfungsi
            CAS:BindActionAtPriority("BlockJump", function() 
                return Enum.ContextActionResult.Sink 
            end, false, Enum.ContextActionPriority.High.Value, Enum.KeyCode.Space)
            
            if hum then 
                hum.JumpPower = 0 
                hum.WalkSpeed = 0 
                hum:SetStateEnabled(Enum.HumanoidStateType.Jumping, false)
            end
        else
            -- // JIKA DI-ON-KAN // --
            CAS:UnbindAction("BlockJump") -- Lepas blokir spasi
            task.spawn(function()
                while _G.UnblockActive do
                    local h = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
                    if h then 
                        h.JumpPower = 50 
                        h.WalkSpeed = 16 
                        h:SetStateEnabled(Enum.HumanoidStateType.Jumping, true)
                    end
                    task.wait(0.1)
                end
            end)
        end
    end
})

AboutTab:Button({
    Title = "Copy Discord Link",
    Callback = function()
        setclipboard("https://discord.gg/NcG6cnZ3m5")
        WindUI:Notify({ Title = "Success", Content = "Link copied!", Duration = 3 })
    end
})

-- // 8. OPEN BUTTON // --
Window:EditOpenButton({
    Title = "", 
    Icon = "rbxassetid://85002796312935", 
    CornerRadius = UDim.new(0,16),
    StrokeThickness = 2,
    Color = ColorSequence.new(Color3.fromHex("FF0F7B"), Color3.fromHex("F89B29")),
    OnlyMobile = false,
    Enabled = true,
    Draggable = true,
})

-- // 9. EVENT HANDLER // --
local function resetJump()
    -- Jika Unblock AKTIF, jangan di-reset ke 0
    if _G.UnblockActive then return end 
    
    local hum = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
    if hum then 
        hum.JumpPower = 0 
        hum.WalkSpeed = 0 
        hum:SetStateEnabled(Enum.HumanoidStateType.Jumping, false)
        -- Paksa block spasi lagi buat jaga-jaga
        game:GetService("ContextActionService"):BindActionAtPriority("BlockJump", function() 
            return Enum.ContextActionResult.Sink 
        end, false, Enum.ContextActionPriority.High.Value, Enum.KeyCode.Space)
    end
end

MatchUIEvent.OnClientEvent:Connect(function(action, value)
    if action == "UpdateServerLetter" then 
        CurrentPrefix = tostring(value):lower()
    elseif action == "ShowMatchUI" then
        IsMatchActive = true
        if not _G.UnblockActive then resetJump() end -- Langsung block pas UI muncul
    elseif action == "HideMatchUI" or action == "Eliminated" then
        IsMatchActive = false
        -- Saat mati/selesai, biarkan player bisa gerak lagi (tergantung mau lo gimana)
        local hum = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
        if hum then 
            hum.JumpPower = 50 
            hum.WalkSpeed = 16 
            hum:SetStateEnabled(Enum.HumanoidStateType.Jumping, true)
            game:GetService("ContextActionService"):UnbindAction("BlockJump")
        end
    elseif action == "StartTurn" then
        MyTurnActive = true
        if KamusReady and AutoAns.Value then task.spawn(executeAutoInput) end
    elseif action == "EndTurn" then
        MyTurnActive = false
        if not _G.UnblockActive then resetJump() end
    end
end)

BillboardEnd.OnClientEvent:Connect(function() MyTurnActive = false if not _G.UnblockActive then resetJump() end end)
ResultUIEvent.OnClientEvent:Connect(function() MyTurnActive = false IsMatchActive = false if not _G.UnblockActive then resetJump() end end)

MainTab:Select()
